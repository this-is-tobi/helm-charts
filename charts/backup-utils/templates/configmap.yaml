{{- range $backupName, $backup := .Values.backups }}
{{- if and $backup.enabled (or $backup.env $.Values.global.env) }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ printf "%s-%s" (include "backup-utils.fullname" $) (include "backup-utils.toKebabCase" $backupName) }}
  labels: {{- include "backup-utils.labels" (list $ $backupName) | nindent 4 }}
data:
{{- if $.Values.global.env }}
{{- include "backup-utils.env" $.Values.global | indent 2 }}
{{- end }}
{{- if $backup.env }}
{{- include "backup-utils.env" $backup | indent 2 }}
{{- end }}
{{- end }}
{{- end }}
