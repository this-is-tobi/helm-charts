fullnameOverride: "backups"

# Global S3 configuration shared across all backup jobs
global:
  env:
    S3_PATH_STYLE: "true"
  secrets:
    S3_ENDPOINT: "https://s3.amazonaws.com"
    S3_ACCESS_KEY: "test-key"
    S3_SECRET_KEY: "test-secret"
    S3_BUCKET_NAME: "test-backups"

backups:
  # PostgreSQL database backup
  postgres:
    enabled: true
    type: "postgres"
    image:
      repository: "ghcr.io/this-is-tobi/tools/backup"
      pullPolicy: "IfNotPresent"
      tag: "0.1.0"
    job:
      schedule: "0 2 * * *"
      successfulJobsHistoryLimit: 3
      failedJobsHistoryLimit: 3
      concurrencyPolicy: "Forbid"
      timeZone: "UTC"
      backoffLimit: 3
    restartPolicy: Never
    container:
      port: 8080
    env:
      RETENTION: "7d"
    secrets:
      S3_BUCKET_PREFIX: "postgres/prod"
      DB_HOST: "postgres.default.svc.cluster.local"
      DB_PORT: "5432"
      DB_NAME: "mydb"
      DB_USER: "postgres"
      DB_PASS: "secret"
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "250m"

  # Vault snapshot backup
  vault:
    enabled: true
    type: "vault"
    image:
      repository: "ghcr.io/this-is-tobi/tools/backup"
      pullPolicy: "IfNotPresent"
      tag: "0.1.0"
    job:
      schedule: "0 3 * * *"
      successfulJobsHistoryLimit: 3
      failedJobsHistoryLimit: 3
      concurrencyPolicy: "Forbid"
      timeZone: "UTC"
      backoffLimit: 3
    restartPolicy: Never
    container:
      port: 8080
    env:
      RETENTION: "14d"
    secrets:
      S3_BUCKET_PREFIX: "vault/prod"
      VAULT_ADDR: "https://vault.default.svc.cluster.local:8200"
      VAULT_TOKEN: "root-token"
      VAULT_EXTRA_ARGS: ""
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "250m"

  # Qdrant vector database backup
  qdrant:
    enabled: true
    type: "qdrant"
    image:
      repository: "ghcr.io/this-is-tobi/tools/backup"
      pullPolicy: "IfNotPresent"
      tag: "0.1.0"
    job:
      schedule: "0 4 * * *"
      successfulJobsHistoryLimit: 3
      failedJobsHistoryLimit: 3
      concurrencyPolicy: "Forbid"
      timeZone: "UTC"
      backoffLimit: 3
    restartPolicy: Never
    container:
      port: 8080
    env:
      RETENTION: "14d"
    secrets:
      S3_BUCKET_PREFIX: "qdrant/prod"
      QDRANT_URL: "https://qdrant.default.svc.cluster.local:6333"
      QDRANT_API_KEY: "test-api-key"
      QDRANT_COLLECTION: ""  # Empty = backup all collections
    resources:
      requests:
        memory: "256Mi"
        cpu: "200m"
      limits:
        memory: "1Gi"
        cpu: "500m"

  # S3-to-S3 bucket sync backup
  s3-sync:
    enabled: true
    type: "s3"
    image:
      repository: "ghcr.io/this-is-tobi/tools/backup"
      pullPolicy: "IfNotPresent"
      tag: "0.1.0"
    job:
      schedule: "0 5 * * *"
      successfulJobsHistoryLimit: 3
      failedJobsHistoryLimit: 3
      concurrencyPolicy: "Forbid"
      timeZone: "UTC"
      backoffLimit: 3
    restartPolicy: Never
    container:
      port: 8080
    env:
      RETENTION: "30d"
    secrets:
      S3_BUCKET_PREFIX: "s3-sync/prod"
      SOURCE_S3_ENDPOINT: "https://s3.us-west-2.amazonaws.com"
      SOURCE_S3_ACCESS_KEY: "source-test-key"
      SOURCE_S3_SECRET_KEY: "source-test-secret"
      SOURCE_S3_BUCKET_NAME: "source-bucket"
      SOURCE_S3_BUCKET_PREFIX: "data/"
    resources:
      requests:
        memory: "256Mi"
        cpu: "200m"
      limits:
        memory: "1Gi"
        cpu: "500m"
