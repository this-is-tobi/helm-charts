{{/*
ScheduledBackup resource.
Uses plugin method when legacyMode is false (default).
Uses traditional method when legacyMode is true.
*/}}
{{- if .Values.backup.enabled }}
apiVersion: postgresql.cnpg.io/v1
kind: ScheduledBackup
metadata:
  name: {{ include "template.fullname" . }}
  labels: {{- include "template.labels" . | nindent 4 }}
  {{- if .Values.annotations }}
  annotations: {{- toYaml .Values.annotations | nindent 4 }}
  {{- end }}
spec:
  schedule: {{ .Values.backup.cron }}
  backupOwnerReference: self
  cluster:
    name: {{ include "template.fullname" . }}
  {{- if not .Values.backup.legacyMode }}
  method: plugin
  pluginConfiguration:
    name: barman-cloud.cloudnative-pg.io
  {{- end }}
{{- end }}
